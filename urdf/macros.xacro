<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="mirte">
  <xacro:macro name="inertia_box" params="x y z mass *origin">
    <inertial>
      <mass>
        <value>${mass}</value>
      </mass>
      <xacro:insert_block name="origin"/>
      <inertia>
        <ixx>${mass / 12.0 * (y*y + z*z)}</ixx>
        <ixy>0.0</ixy>
        <ixz>0.0</ixz>
        <iyy>${mass / 12.0 * (z*z + x*x)}</iyy>
        <iyz>0.0</iyz>
        <izz>${mass / 12.0 * (y*y + x*x)}</izz>
      </inertia>
    </inertial>
  </xacro:macro>
  <xacro:macro name="inertia_cylinder" params="r h mass">
    <inertial>
      <mass>
        <value>${mass}</value>
      </mass>
      <!-- <xacro:insert_block name="origin"/> -->
      <inertia>
        <ixx>${mass / 12 * (3*r*r + h*h)}</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>${mass / 12 * (3*r*r + h*h)}</iyy>
        <iyz>0</iyz>
        <izz>${mass / 2 * r * r}</izz>
      </inertia>
    </inertial>
  </xacro:macro>
  <xacro:macro name="inertia_sphere" params="r mass *origin">
    <inertial>
      <mass>
        <value>${mass}</value>
      </mass>
      <xacro:insert_block name="origin"/>
      <inertia>
        <ixx>${2/5 * mass * r*r}</ixx>
        <ixy>0</ixy>
        <ixz>0</ixz>
        <iyy>${2/5 * mass * r*r}</iyy>
        <iyz>0</iyz>
        <izz>${2/5 * mass * r*r}</izz>
      </inertia>
    </inertial>
  </xacro:macro>
  <xacro:macro name="wheel" params="name parent radius mass visualRot mult=1  *pose **content">
    <link name="link_${name}">
      <xacro:insert_block name="pose"/>
      <xacro:inertia_cylinder r="${radius}" h="0.015" mass="${mass}">
        
      </xacro:inertia_cylinder>
      <collision name="link_${name}_collision">
        <!-- <origin> <rpy>0 1.5707 1.5707</rpy><xyz>0 0 0</xyz></origin> -->
        <geometry>
          <cylinder>
            <length>0.015</length>
            <radius>${radius}</radius>
          </cylinder>
        </geometry>
        <!-- <surface>
          <friction>
            <ode>
              <mu>1</mu>
              <mu2>1</mu2>
            </ode>
          </friction>
        </surface> -->
      </collision>
      <!-- <visual name="link_${name}_visual">
        <origin rpy="0 1.5707 1.5707"  xyz="-0 0 0" />
        <geometry>

          <cylinder color="pink" length="0.015" radius="${radius}"/>
               

        </geometry>
        <material name="red" />
      </visual> -->
      <visual name="link_${name}_visual">
        <!-- <origin rpy="0 1.5707 ${1.5707 + visualRot*pi}" xyz="-0 0.0 0"/> -->
        <geometry>
          <!-- <pose>0 0 ${pi*0 + visualRot*pi}</pose> -->
          <mesh>
            <uri>file://$(find mirte_gazebo)/meshes/wheel.stl</uri>
            <scale>1 1 1</scale>
          </mesh>
        </geometry>
      </visual>
    </link>
    <joint name="joint_${name}" type="revolute">
      <!-- <xacro:insert_block name="origposein"/> -->
      <child>link_${name}</child>
      <parent>${parent}</parent>
      <axis>
        <rpy>0 0 0</rpy>
        <xyz>0 0 ${mult}</xyz>
      </axis>
      <xacro:insert_block name="content"/>
    </joint>
    <transmission name="trans_${name}">
      <type>transmission_interface/SimpleTransmission</type>
      <joint name="joint_${name}">
        <hardwareInterface>
          hardware_interface/VelocityJointInterface</hardwareInterface>
      </joint>
      <actuator name="motor_${name}">
        <hardwareInterface>
          hardware_interface/VelocityJointInterface</hardwareInterface>
        <mechanicalReduction>1</mechanicalReduction>
      </actuator>
    </transmission>
  </xacro:macro>
  <xacro:macro name="caster" params="name parent radius mass *pose">
    <link name="link_${name}">
    <inertial>
        <mass>
        4.0</mass>
        <!-- <origin rpy="0 0 0" xyz="0 0 0"/> -->
        <inertia>
         <ixx>9.108e-05</ixx> <ixy>0</ixy><ixz>0</ixz><iyy>2.51e-06</iyy><iyz>0</iyz><izz>8.931e-05</izz>
         </inertia>
      </inertial>
      <xacro:insert_block name="pose"/>
      <collision name="link_${name}_collision">
        <geometry>
          <sphere>
            <radius>${radius}</radius>
          </sphere>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.01</mu>
              <mu2>0.01</mu2>
            </ode>
          </friction>
        </surface>
      </collision>
      <visual name="vis_${name}_sphere">
        <origin/>
        <!-- <xacro:insert_block name="origin"/> -->
        <geometry>
          <sphere>
            <radius>${radius}</radius>
          </sphere>
        </geometry>
        <material>
          <name>red</name>
        </material>
      </visual>
      <xacro:inertia_sphere r="${radius}" mass="${mass}">
        <!-- <xacro:insert_block name="origin"/> -->
        <origin/>
      </xacro:inertia_sphere>
    </link>
    <gazebo reference="link_${name}">
      <gravity>0</gravity>
    </gazebo>
    <joint name="fixed" type="fixed">
      <parent>${parent}</parent>
      <child>link_${name}</child>
    </joint>
  </xacro:macro>
</robot>
